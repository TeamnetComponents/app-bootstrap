<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <property name="now" value="now()" dbms="mysql,h2"/>
    <property name="now" value="current_timestamp" dbms="postgresql"/>
    <property name="now" value="sysdate" dbms="oracle"/>

    <property name="file_ext" value="_orcl" dbms="oracle" />
    <property name="file_ext" value="" dbms="!oracle" />

    <changeSet id="03022015" author="bootstrap">
        <createTable tableName="T_MENU">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="parent_id" type="bigint"/>
            <column name="name" type="varchar(100)"/>
            <column name="route" type="varchar(255)"/>
            <column name="css_class" type="varchar(100)"/>
            <column name="sort_no" type="bigint"/>
            <column name="active" type="bigint"/>
            <column name="module_name" type="varchar(100)"/>
            <column name="module_id" type="bigint"/>
        </createTable>

        <!-- insert application menus -->
        <!--<loadData encoding="UTF-8"-->
                  <!--file="config/liquibase/menus${file_ext}.csv"-->
                  <!--separator=";"-->
                  <!--tableName="T_MENU">-->
            <!--<column name="activated" type="boolean"/>-->
        <!--</loadData>-->

        <!-- insert menu modules | POSTGRESQL tested only -->
        <!--<sql>-->
            <!--insert into t_module (id_module, version, code, type, description)-->
            <!--select-->
                <!--nextval('t_module_id_module_seq'),-->
                <!--1,-->
                <!--upper('MENU_' || me.id),-->
                <!--1,-->
                <!--name-->
            <!--from t_menu me;-->
        <!--</sql>-->

        <!-- update menu with corresponding module id | POSTGRESQL tested only -->
        <!--<sql>-->
            <!--update t_menu set module_id = (select mo.id_module from t_module mo where mo.code = 'MENU_'||id );-->
        <!--</sql>-->

        <!-- update module child parents corresponding to menu child parents | POSTGRESQL tested only -->
        <!--<sql>-->
            <!--update-->
                <!--t_module t-->
            <!--set-->
                <!--fk_parent_module = t3.module_id-->
            <!--from-->
                <!--t_menu t2, t_menu t3-->
            <!--where-->
                <!--t.code = 'MENU_'||t2.id-->
                <!--and t2.parent_id = t3.id-->
                <!--and t.id_module = t2.module_id;-->
        <!--</sql>-->
    </changeSet>
</databaseChangeLog>
